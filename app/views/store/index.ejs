<div class="container w1002 tn_margin" id="qiye">
    <%- partial("layouts/info_nav", {current_url: "/store"}) %>
    <div class="col-lg-10 col-md-10 col-sm-10 youce">
        <div class="bg_pale_yellow">
            <div class="col-lg-12 col-md-12 col-sm-12 pad_topbot_change">
                <h4 class="lh h4_line">
                    <div class="w120 pull-left ts_padding">仓库信息</div>
                    <%
                    function removeURLParameter(url, parameter) {
                        var urlparts = url.split('?');
                        if (urlparts.length >= 2) {
                            var prefix = encodeURIComponent(parameter) + '=';
                            var pars = urlparts[1].split(/[&;]/g);
                            for (var i = pars.length; i-- > 0;)
                                if (pars[i].lastIndexOf(prefix, 0) !== -1)
                                    pars.splice(i, 1);
                            url = urlparts[0] + '?' + pars.join('&');
                            return url;
                        } else {
                            return url;
                        }
                    }
                    base = removeURLParameter(base, 'status');
                    var base_url = base + (base.indexOf('?') < 0 ? '?' : '&') + 'status=';

                            if(status){
                            if(status == 2)
                    {
                    %>
                    <div class="third_nav"><a href="/store">全部信息</a></div>
                    <div class="third_nav third_hover"><a href="<%= base_url %>2">已发布</a></div>
                    <div class="third_nav"><a href="<%= base_url %>1">未发布</a></div>
                    <%
                    }
                    else if(status == 1)
                    {
                    %>
                    <div class="third_nav"><a href="/store">全部信息</a></div>
                    <div class="third_nav"><a href="<%= base_url %>2">已发布</a></div>
                    <div class="third_nav third_hover"><a href="<%= base_url %>1">未发布</a></div>
                    <%
                    }
                    else
                    {
                    %>
                    <div class="third_nav third_hover"><a href="/store">全部信息</a></div>
                    <div class="third_nav"><a href="<%= base_url %>2">已发布</a></div>
                    <div class="third_nav"><a href="<%= base_url %>1">未发布</a></div>
                    <%
                    }
                    }else
                    {
                    %>
                    <div class="third_nav third_hover"><a href="/store">全部信息</a></div>
                    <div class="third_nav"><a href="<%= base_url %>2">已发布</a></div>
                    <div class="third_nav"><a href="<%= base_url %>1">未发布</a></div>
                    <%
                    } %>

                    <a href="/store/add" class="btn pull-right btn-info btn-sm">发布仓库</a>
                </h4>
            </div>
        </div>
        <div class="col-lg-12 col-md-12 col-sm-12">
            <div class="line_search">
                <form class="navbar-form navbar-left" role="search">
                    <div class="w260 pull-left">
                        <div class="w80 pull-left ts_padding">仓库类型：</div>
                        <div class="w180 pull-left">
                            <select id="storeType" class="form-control min_hundred w160 input-sm">
                                <option>选择仓库类型</option>
                                <%
                                if(locals.store_type){
                                        store_type.forEach(function(storeType){
                                %>
                                <option value="<%= storeType.id %>"><%= storeType.name %></option>
                                <%
                                });
                                }
                                %>
                            </select>
                        </div>
                    </div>
                    <div class="w260 pull-left">
                        <div class="w80 pull-left ts_padding">经营范围：</div>
                        <div class="w180 pull-left">
                            <select id="businessScope" class="form-control min_hundred w160 input-sm">
                                <option>选择经营范围</option>
                                <%
                                if(locals.business_scope){
                                        business_scope.forEach(function(businessScope){
                                %>
                                <option value="<%= businessScope.id %>"><%= businessScope.name %></option>
                                <%
                                });
                                }
                                %>
                            </select>
                        </div>
                    </div>
                    <div class="pull-left w100"><input type="button" value="搜索" class="btn btn-success btn-sm"
                                                       onclick="search()"/></div>
                </form>
                <div class="clearfix"></div>
            </div>
        </div>
        <script type="text/javascript">
            $(function () {
                $('.info .info_item').hover(function () {
                    $('.info .info_item').removeClass('info_item_hover');
                    $(this).addClass('info_item_hover');
                });
            });
        </script>
        <div class="col-lg-12 col-dm-12 col-sm-12 info tn_margin">
            <% if(locals.stores && locals.stores.length){
            %>
            <%- partial('store/list', {
                stores: stores,
                current_page: current_page,
                list_count: list_count,
                pages: pages,
                base: base
            }) %>
            <% }else{
                    if(base == "/store" || base == "/store/"){ %>
            <div class="info_item">
                <div class="col-lg-12 tl_padding bl_padding text-danger text-center">您还没有发布信息哦，<a href="/store/add">赶快去发布信息</a>
                </div>
            </div>
            <% }else{ %>
            <div class="info_item">
                <div class="col-lg-12 tl_padding bl_padding text-danger text-center">对不起，没有找到适合您的信息
                </div>
            </div>
            <% } } %>
        </div>
    </div>
</div>
<!--<input type="hidden" id="sProvince" name="sProvince" value="">-->
<!--<input type="hidden" id="sCity" name="sCity" value="">-->
<!--<input type="hidden" id="eProvince" name="eProvince" value="">-->
<!--<input type="hidden" id="eCity" name="eCity" value="">-->

<script src="/js/jquery.provincesCity.js" type="text/javascript"></script>
<script src="/js/core/city.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        var storeType = '<%=storeTypeCode%>';
        var businessScope = '<%=businessScopeCode%>';

        if (storeType && storeType != 'undefined')
            $("#storeType").val(storeType).change();
        if (businessScope && businessScope != 'undefined')
            $("#businessScope").val(businessScope).change();
    });
    function search() {
        var url = "";
        var storeType = $("#storeType").val();
        var businessScope = $("#businessScope").val();

        if (storeType && storeType != "选择仓库类型") {
            url += "storeType=" + storeType;
        }
        if (businessScope && businessScope != "选择经营范围") {
            url += "&businessScope=" + businessScope;
        }
        if (url) {
            if (url.substr(0, 1) == "&")
                url = url.substr(1, url.length - 1);
            window.location.href = "/store?" + url;
        }
        else
        {
            window.location.href = "/store";
        }
    }
</script>